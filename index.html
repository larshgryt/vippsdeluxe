<!DOCTYPE html>
<html>
    <head>
        <script src="build/tracking.js"></script>
        <meta charset="utf8">
        <title>VIPPS GAVE</title>
        <meta name="description" content="En gavekorts tjeneste for Vipps">
        <link rel="stylesheet" href="main.css">
        
    </head>
    
    
    <body>
        <!-- Image to be matched from -->
        <img id="imageSrc1" alt="No Image" style="visibility: hidden; position:fixed;"/>

        <!-- Image to look for features in -->
        <img id="imageSrc2" alt="No Image" style="visibility: hidden; position:fixed;"/>
        <div id="mainarea">
            <div id="topnav">
                <span id="topnav_button_left" onclick="backToSendGift()" class="navtext"> &lt; </span>
                <span id="topnavcontent" class="navtext">
                      Send a gift
                </span>
                <span id="topnav_button_right" class="navtext" onclick="makePreview()"></span>
            </div>
            <div id="navbuttonsdiv">
                <button id="sendbtn" class="navbutton" type="button" onclick="sendPage()">Send</button>
                <button id="receivebtn" class="navbutton" type="button" onclick="receivePage()">Receive</button>
                <button id="histbtn" class="navbutton" type="button" onclick="historyPage()">History</button>
            </div>
            <div id="searchbar">
                <input class="searchinput" type="text" placeholder="Search by name or mobile number">
            </div>
            <div id="maincontent">
                <div id=send>
                    
                <ul class="list"  >
                    <li onCLick="chooseUser()"><img src= "images/face.png" alt="face icon" height="50" width="50">Lars Henrik Grytten</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Agata Jedryszek</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Andreas Gronlien</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Iselin Erikssen</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Hello Anderson</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Byebye Anderson</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Cruel Word</li>
                    <li><img src= "images/face.png" alt="face icon" height="50" width="50">Please Help</li>
                </ul>
                </div>
                <div id="receive">
                    <input type="button" name="" id="scan_button" value="SCAN IMAGE">

                </div>
                <div id="history">
                    <p id=empty_list>You have not received or sent any gifts yet.</p>
                    <ul id=history_list></ul>
                </div>
                <div id="sendifo_form">
                    <div class="center_element"><img src="images/face.png" alt="face icon" height="50" width="50">

                    <p class="whitetext">To: Lars Henrik Grytten</p>
                    </div>
                        
                    <div id="address_form">
                    <p>Amount: <input type="number" id="input_amount" name="" placeholder="kr"></p>
                    <p>Street: <input type="" id="input_address_street" placeholder="street..." name=""></p>
                    <p>City/town: <input type="" id="input_address_city" placeholder="city/town..." name=""></p>
                    <p>Postal code: <input type="" id="input_address_code" placeholder="postal code..." name=""></p>
                    <p><input type="button" name="" value="Upload image"></p>
                    </div>
                    <p class="message"><input type="text" id="input_message" name="" placeholder="Write a message..."><span id="message_arrow" onclick="makePreview()">&gt;</span></p>
                </div>

                <div id=preview>
                    <p id="output_image"></p>
                    <div id=preview_content>
                        
                    <p id="output_from_name">From: Ola Norman</p>
                    <p id="output_name">To: Lars Henrik Grytten</p>
                    <p id="output_amount">kr </p>
                    <p></p>
                    <p id="output_street"></p>
                    <p id="output_city"></p>
                    <p id="output_zip"></p>
                    <p></p>
                    <p id="output_message"></p>
                    </div>
                    <input id="send_button" type="button" name="" value="SEND">
            </div>
        </div>
        <input type="file" id="fileInput1" name="file" style="position:fixed; top:15px; left:10px;"/>
        <input type="file" id="fileInput2" name="file" style="position:fixed; top:45px; left:10px;"/>
        <input type="button" id="run_button" value="Run function" style="position:fixed; top:75px; left:10px;"/>
        <canvas id="canvas" style="width:1000px;height:500px; position:fixed; top:0px; left:0px; z-index:-999;"></canvas>
        <script type="text/javascript" src="script.js"></script>
        <script type="text/javascript">
            let imgElement1 = document.getElementById('imageSrc1');
            let imgElement2 = document.getElementById('imageSrc2');
            let inputElement1 = document.getElementById('fileInput1');
            let inputElement2 = document.getElementById('fileInput2');
            let run_button = document.getElementById('run_button');
            
            inputElement1.addEventListener('change', (e) => {
              imgElement1.src = URL.createObjectURL(e.target.files[0]);
            }, false);
            inputElement2.addEventListener('change', (e) => {
              imgElement2.src = URL.createObjectURL(e.target.files[0]);
            }, false);
            
            run_button.onclick = function() {
                
                var canvas = document.getElementById('canvas');
                var context = canvas.getContext('2d');
                var width = canvas.width / 2;
                var height = canvas.height;
                var image1 = document.getElementById('imageSrc1');
                var image2 = document.getElementById('imageSrc2');
            
            
                window.descriptorLength = 256;
                window.matchesShown = 30;
                window.blurRadius = 3;
                var doMatch = function() {
                  tracking.Brief.N = window.descriptorLength;
                  context.drawImage(image1, 0, 0, width, height);
                  context.drawImage(image2, width, 0, width, height);
              
                  var imageData1 = context.getImageData(0, 0, width, height);
                  var imageData2 = context.getImageData(width, 0, width, height);
              
                  var gray1 = tracking.Image.grayscale(tracking.Image.blur(imageData1.data, width, height, blurRadius), width, height);
                  var gray2 = tracking.Image.grayscale(tracking.Image.blur(imageData2.data, width, height, blurRadius), width, height);
              
                  var corners1 = tracking.Fast.findCorners(gray1, width, height);
                  var corners2 = tracking.Fast.findCorners(gray2, width, height);
              
                  var descriptors1 = tracking.Brief.getDescriptors(gray1, width, corners1);
                  var descriptors2 = tracking.Brief.getDescriptors(gray2, width, corners2);
              
                  var matches = tracking.Brief.match(corners1, descriptors1, corners2, descriptors2);
            
                  matches.sort(function(a, b) {
                    return b.confidence - a.confidence;
                  });
            
                  let n_matches = Math.min(window.matchesShown, matches.length);
            
                  let clustering_distances_x = new Array();
                  let clustering_distances_y = new Array();
                  
                  let avg_clustering_distance = 0;
            
                  let avg_x = 0;
                  let avg_y = 0;
            
              
                  for (var i = 0; i < n_matches; i++) {
                    var color = '#' + Math.floor(Math.random()*16777215).toString(16);
                    context.fillStyle = color;
                    context.strokeStyle = color;
                    context.fillRect(matches[i].keypoint1[0], matches[i].keypoint1[1], 4, 4);
                    context.fillRect(matches[i].keypoint2[0] + width, matches[i].keypoint2[1], 4, 4);
                    context.beginPath();
                    context.moveTo(matches[i].keypoint1[0], matches[i].keypoint1[1]);
                    context.lineTo(matches[i].keypoint2[0] + width, matches[i].keypoint2[1]);
                    context.stroke();
            
            
                    clustering_distances_x[i] = matches[i].keypoint1[0] - matches[i].keypoint2[0];
                    clustering_distances_y[i] = matches[i].keypoint1[1] - matches[i].keypoint2[1];
            
                    avg_x += clustering_distances_x[i];
                    avg_y += clustering_distances_y[i];
            
                  }
            
                  avg_x /= n_matches;
                  avg_y /= n_matches;
            
                  for (var i = 0; i < n_matches; i++) {
                      clustering_distances_x[i] -= avg_x;
                      clustering_distances_y[i] -= avg_y;
            
                      avg_clustering_distance += Math.sqrt(clustering_distances_x[i]**2 + clustering_distances_y[i]**2) / n_matches;
                  }
            
                  
            
                  console.log(avg_clustering_distance);
            
            
            
                };
                doMatch();
            
                
            };
        </script>
    </body>
</html>